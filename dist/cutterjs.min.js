/**
 * CropperJS v1.0.0 Copyright (c) Fri Jul 31 2020 19:16:38 GMT+0800 (中国标准时间), JIANGXUEYANG All Rights Reserved,
 *     see: for Details
 *     @license MIT
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("core-js/modules/es6.number.constructor"),require("core-js/modules/es6.array.for-each"),require("core-js/modules/es6.regexp.to-string"),require("core-js/modules/es6.date.to-string"),require("core-js/modules/es6.object.to-string")):"function"==typeof define&&define.amd?define(["core-js/modules/es6.number.constructor","core-js/modules/es6.array.for-each","core-js/modules/es6.regexp.to-string","core-js/modules/es6.date.to-string","core-js/modules/es6.object.to-string"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Cutter=t()}(this,function(){"use strict";function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(t,e){var i,r=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)),r}function w(o){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?t(Object(n),!0).forEach(function(e){var t,i,r;t=o,r=n[i=e],i in t?Object.defineProperty(t,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[i]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))})}return o}function H(e){return Object.prototype.toString.call(e).toLowerCase().slice(8,-1)}function E(e){return"function"===H(e)}function x(e){return null===e||""===e||void 0===e}function S(e){return"number"===H(e)||/^\d+$/.test(e)}function C(e){return console.error(e),!1}function j(e,t){var i=1<arguments.length&&void 0!==t?t:2;return Number(e.toFixed(i))}return function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.rotate=0,this.dragStatus=0,this.cursorEnums=["default","nw-resize","w-resize","sw-resize","n-resize","s-resize","ne-resize","e-resize","se-resize","move"],this.cropperIsEnter=!1,this.ropperIsDown=!1,this.startPos=null,this.defaultConfig={cropWidth:200,cropHeight:200,minCropWidth:16,minCropHeight:16,maxScale:3,minScale:.1,scale:1.2,canMagnify:!0,canReduce:!0,canRotate:!0,canChangeCropSize:!0,imageSrc:"",containerEl:"",mangnifyEl:"",reduceEl:"",cropEl:"",rotateEl:"",onRender:null,onCrop:null},this.checkConfig(e)&&this.init()}var e,i,r;return e=t,(i=[{key:"checkConfig",value:function(t){if(x(t))return!1;if("object"!==H(t))return C("配置信息格式不合法");["cropWidth","cropHeight","minCropWidth","minCropHeight","maxScale","minScale","scale"].forEach(function(e){t.hasOwnProperty(e)&&(t[e]=parseFloat(t[e]))});var e=(t=w(w({},this.defaultConfig),t)).containerEl,i=t.minCropWidth,r=t.minCropHeight,o=t.cropWidth,n=t.cropHeight,s=t.maxScale,a=t.minScale,c=t.canReduce,h=t.canMagnify;if(x(e))return C("containerEl未配置");var u=document.querySelector(e);if(!u)return C(e+"的dom元素不存在");if(this.container=u,t.canChangeCropSize){if(!x(r)){if(!S(r))return C("minCropHeight必须为数值");if(Number(r)<1)return C("minCropHeight不能小于1")}if(!x(i)){if(!S(i))return C("minCropWidth必须为数值");if(Number(i)<1)return C("minCropWidth不能小于1")}}if(!x(o)){if(!S(o))return C("cropWidtht必须为数值");if(Number(o)<1)return C("cropWidth不能小于1")}if(!x(n)){if(!S(n))return C("cropHeight必须为数值");if(Number(n)<1)return C("cropHeight不能小于1")}if(h){if(!x(s)){if(!S(s))return C("maxScale必须为数值");if(Number(s)<1)return C("maxScale不能小于1")}var l=t.mangnifyEl;if(x(l))return C("mangnifyEl未配置");var f=document.querySelector(l);if(!f)return C(l+"的dom元素不存在");this.mangnifyNode=f}if(c){if(!x(a)){if(!S(a))return C("minScale必须为数值");if(1<=Number(a))return C("minScale必须小于1")}var g=t.reduceEl;if(x(g))return C("reduceEl未配置");var p=document.querySelector(g);if(!p)return C(g+"的dom元素不存在");this.reduceNode=p}if(h||c){var m=this.scale;if(!x(m)){if(!S(m))return C("scale必须为数值");if(Number(s)<=1)return C("scale必须大于1")}}var d=t.cropEl;if(!x(d)){var y=document.querySelector(d);if(!y)return C(d+"的dom不存在");this.submitNode=y}if(x(t.imageSrc))return C("imageSrc不能为空");var v=t.canRotate,b=t.rotateEl;if(v){if(x(b))return C("rotateEl未配置");var k=document.querySelector(b);if(!k)return C(b+"的dom不存在");this.rotateNode=k}return this.config=t,!0}},{key:"init",value:function(){var t=this;this.canvas=document.createElement("canvas"),this.loadImage(function(){t.initContainer();var e=t.config.onRender;E(e)&&e(),t.bindEvent()})}},{key:"loadImage",value:function(e){var t=this,i=this.config.imageSrc,r=new Image;r.src=i,r.onload=function(){t.image=r,E(e)&&e()},r.onerror=function(){C("图片资源加载失败")}}},{key:"initContainer",value:function(){var e=this.container,t=this.image,i=t.naturalHeight,r=t.naturalWidth,o=e.offsetHeight,n=e.offsetWidth;this.containerH=o,this.containerW=n;var s=this.orgImgW=r,a=r/(this.orgImgH=i);o<(h=i)?n<s&&a<n/o?s=(h=o)*a:h=(s=n)/a:n<s&&(s=(h=o)*a);var c=this.adjustToCrop(s,h),s=j(c.imgWidth),h=j(c.imgHeight);t.style.width=s+"px",t.style.height=h+"px";var u=(o-h)/2,l=(n-s)/2;this.imgWidth=s,this.imgHeight=h,t.style.top=u+"px",t.style.left=l+"px",this.imgTop=u,this.imgLeft=l,t.style.position="absolute",e.style.position="relative",e.style.overflow="hidden",e.appendChild(t),this.addMask()}},{key:"addMask",value:function(){var t=this.container,e=this.containerH,i=this.containerW,r=this.config,o=r.cropHeight,n=r.cropWidth,s=document.createElement("div");s.setAttribute("style","position:absolute;box-sizing: border-box;border: 1px dashed #fff;");var a=this.createMask(),c=this.createMask(),h=this.createMask(),u=this.createMask();a.style.left=0,c.style.right=0,h.style.top=0,u.style.bottom=0,[a,c,h,u,s].forEach(function(e){t.appendChild(e)}),this.cropBox=s,this.leftMask=a,this.rightMask=c,this.topMask=h,this.bottomMask=u;var l=(i-n)/2,f=(e-o)/2;this.setMaskStyle(l,f,n,o)}},{key:"setMaskStyle",value:function(e,t,i,r){var o=this.cropBox,n=this.leftMask,s=this.rightMask,a=this.bottomMask,c=this.topMask,h=this.containerW,u=this.containerH;o.style.top=t+"px",o.style.left=e+"px",o.style.width=i+"px",o.style.height=r+"px",s.style.width=h-e-i+"px",n.style.width=e+"px",n.style.height=s.style.height=u+"px",c.style.width=a.style.width=i+"px",a.style.height=u-t-r+"px",c.style.height=t+"px",c.style.left=a.style.left=e+"px",this.config.cropWidth=i,this.config.cropHeight=r,this.cropTop=t,this.cropLeft=e}},{key:"createMask",value:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.background="rgba(255, 255, 255, 0.45)",e}},{key:"bindEvent",value:function(){var t=this,i=this.container;this.cropBox.onmouseenter=function(e){t.cropperIsEnter=!0,t.initMouse(e),i.onmousemove=function(e){t.cropperIsEnter&&(t.cropperIsDown?t.handleResize(e):t.initMouse(e))},i.onmousedown=function(e){t.cropperIsEnter&&(t.dragStatus<=0||(t.cropperIsDown=!0,t.handleMouseDown(e),i.onmouseup=function(){t.cropperIsDown&&(t.cropperIsDown=!1,t.checkCropperBox(),i.onmouseup=null)}))}},i.onmouseleave=function(){t.cropperIsEnter=!1,t.dragStatus=0,t.cropperIsDown=!1,i.onmousemove=null,i.onmousedown=null,i.onmouseup=null,t.checkCropperBox()};var e=this.config,r=e.canRotate,o=e.canMagnify,n=e.canReduce,s=e.scale;o&&this.mangnifyNode&&(this.mangnifyNode.onclick=function(){t.config.canMagnify&&t.changeImageSize(s)}),n&&this.reduceNode&&(this.reduceNode.onclick=function(){t.config.canReduce&&t.changeImageSize(1/s)}),r&&this.rotateNode&&(this.rotateNode.onclick=function(){t.rotateImage()}),this.submitNode&&(this.submitNode.onclick=function(){t.cropImage()})}},{key:"cropImage",value:function(){var e,t,i,r,o,n,s,a,c=this.canvas,h=this.rotate,u=this.orgImgW,l=this.imgHeight,f=this.imgWidth,g=this.imgTop,p=this.imgLeft,m=this.cropLeft,d=this.cropTop,y=this.image,v=this.containerW,b=this.containerH,k=this.config,w=k.cropHeight,H=k.cropWidth,x=k.onCrop,S=f/u,C=c.getContext("2d"),M=H/S,W=w/S;c.width=H,c.height=w,-1===h?(e=j((b-w-d-(b-f)/2)/S),t=j((m-(v-l)/2)/S),M=w/S,W=H/S,C.rotate(90*h*Math.PI/180),C.drawImage(y,e,t,M,W,-w,0,w,H)):-2===h?(i=this.toFixed((v-m-H-(v-f)/2)/S),r=this.toFixed((b-w-d-(b-l)/2)/S),C.rotate(90*h*Math.PI/180),C.drawImage(y,i,r,M,W,-H,-w,H,w)):-3===h?(o=this.toFixed((d-(b-f)/2)/S),n=this.toFixed((v-m-H-(v-l)/2)/S),M=w/S,W=H/S,C.rotate(90*h*Math.PI/180),C.drawImage(y,o,n,M,W,0,-H,w,H)):(s=(m-p)/S,a=(d-g)/S,C.drawImage(y,s,a,M,W,0,0,H,w));var I=c.toDataURL("image/png");return E(x)&&x(I),I}},{key:"changeImageSize",value:function(e){var t=this.imgWidth,i=this.orgImgW,r=this.orgImgH,o=this.imgHeight,n=this.containerH,s=this.containerW,a=this.image,c=this.config,h=c.maxScale,u=c.minScale,l=c.onManify,f=c.onReduce;t*=e,o*=e,1<e?(this.config.canReduce=!0,h<t/i&&(this.config.canMagnify=!1,t=i*h,o=r*h)):(this.config.canMagnify=!0,t/i<u&&(this.containerH.canReduce=!1,t=i*u,o=r*u));var g=this.adjustToCrop(t,o),t=j(g.imgWidth),o=j(g.imgHeight);this.imgWidth=t,this.imgHeight=o,a.style.width=t+"px",a.style.height=o+"px";var p=j((n-o)/2),m=j((s-t)/2);a.style.top=p+"px",a.style.left=m+"px",this.imgTop=p,this.imgLeft=m,this.checkCropperBox(),1<e&&E(l)&&l(this.config),e<1&&E(f)&&f(this.config)}},{key:"rotateImage",value:function(){var e=this.rotate;--e%4==0&&(e=0),this.image.style.transform="rotate(".concat(90*e,"deg)"),this.rotate=e,this.checkCropperBox()}},{key:"initMouse",value:function(e){var t,i,r,o,n,s,a,c,h,u,l,f;e.preventDefault(),this.cropperIsEnter&&(t=this.cropBox,i=this.cursorEnums,r=this.container,n=(o=this.config).cropWidth,s=o.cropHeight,a=o.canChangeCropSize,c=e.clientX,l=e.clientY-(h=t.getBoundingClientRect()).top,f=0,(u=c-h.left)<10&&-10<u?l<10&&-10<l?f=1:10<=l&&l<=s-10?f=2:s-10<l&&l<s+10&&(f=3):10<=u&&u<=n-10?l<10&&-10<l?f=4:s-10<l&&l<s+10?f=5:10<=l&&l<=s-10&&(f=9):n-10<u&&u<n+10&&(l<10&&-10<l?f=6:10<=l&&l<=s-10?f=7:s-10<l&&l<s+10&&(f=8)),(a||!a&&9===f)&&(t.style.cursor=i[f]||"default",this.dragStatus=f),(u<-10||n+10<u||l<-10||s+10<l)&&(this.cropperIsEnter=!1,this.cropperIsDown=!1,r.onmousemove=null,r.onmousedown=null,r.onmouseup=null))}},{key:"handleResize",value:function(e){e.preventDefault();var t,i,r=this.config,o=r.cropWidth,n=r.cropHeight,s=r.minCropWidth,a=this.cropTop,c=this.cropLeft,h=this.startPos,u=this.dragStatus,l=this.containerW,f=this.containerH,g=e.clientX-h.clientX,p=e.clientY-h.clientY;if(1<=u&&u<=3){var m,d=o-g,y=c+g,v=n,b=a;if(d<s)return;y<0&&(y=0),1===u?(v=(m=this.resizeTop(n,a,p)).newHeight,b=m.newTop):3===u&&(v=this.resizeBottom(n,a,p).newHeight),this.setMaskStyle(y,b,d,v)}else if(4===u){var k=this.resizeTop(n,a,p),w=k.newHeight,H=k.newTop;this.setMaskStyle(c,H,o,w)}else if(5===u){var x=this.resizeBottom(n,a,p).newHeight;this.setMaskStyle(c,a,o,x)}else if(6<=u&&u<=8){var S,C=o+g,M=a,W=n;if(C<s)return;l<c+C&&(C=l-o),6===u?(W=(S=this.resizeTop(n,a,p)).newHeight,M=S.newTop):8===u&&(W=this.resizeBottom(n,a,p).newHeight),this.setMaskStyle(c,M,C,W)}else{9===u&&((i=a+p)<0&&(i=0),(t=c+g)<0&&(t=0),l<t+o&&(t=l-o),f<i+n&&(i=f-n),this.setMaskStyle(t,i,o,n))}this.startPos={clientX:e.clientX,clientY:e.clientY}}},{key:"checkCropperBox",value:function(){var e,t=this.config,i=t.cropHeight,r=t.cropWidth,o=this.cropBox,n=this.cropTop,s=this.cropLeft,a=this.imgTop,c=this.imgLeft,h=this.imgHeight,u=this.imgWidth,l=this.bottomMask,f=this.topMask,g=this.rightMask,p=this.leftMask,m=this.containerW,d=this.containerH;this.rotate%2!=0&&(c=(m-h)/2,a=(d-u)/2,e=u,u=h,h=e),u<r&&(r=u),h<i&&(i=h),s<c&&(s=c),c+u<s+r&&(s=c+u-r),n<a&&(n=a),a+h<n+i&&(n=a+h-i);var y=[o,l,f,g,p];y.forEach(function(e){e.style.transition="all 0.3s"}),this.setMaskStyle(s,n,r,i),setTimeout(function(){y.forEach(function(e){e.style.transition=""})},300)}},{key:"handleMouseDown",value:function(e){this.startPos={clientX:e.clientX,clientY:e.clientY}}},{key:"resizeTop",value:function(e,t,i){var r=e-i,o=t+i;if(!(r<this.config.minCropHeight))return o<0&&(o=0),{newTop:o,newHeight:r}}},{key:"resizeBottom",value:function(e,t,i){var r=this.containerH,o=e+i;if(!(o<this.config.minCropHeight))return r<t+o&&(o=r-t),{newHeight:o}}},{key:"adjustToCrop",value:function(e,t){var i=this.orgImgW,r=this.orgImgH,o=this.config,n=o.cropWidth,s=o.cropHeight,a=i/r,c=n/s;return t<s?(this.config.canReduce=!1,!(e<n)||c<a?e=(t=s)*a:t=(e=n)/a):e<n&&(this.config.canReduce=!1,t=(e=n)/a),{imgWidth:e,imgHeight:t}}}])&&o(e.prototype,i),r&&o(e,r),t}()});

/**
 * CropperJS v1.0.1 Copyright (c) Fri Jul 31 2020 21:31:32 GMT+0800 (中国标准时间), JIANGXUEYANG All Rights Reserved,
 *     see: for Details
 *     @license MIT
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Cutter=e()}(this,function(){"use strict";function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(e,t){var i,n=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)),n}function w(r){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,i,n;e=r,n=o[i=t],i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(o,t))})}return r}function H(t){return Object.prototype.toString.call(t).toLowerCase().slice(8,-1)}function C(t){return"function"===H(t)}function x(t){return null===t||""===t||void 0===t}function S(t){return"number"===H(t)||/^\d+$/.test(t)}function M(t){return console.error(t),!1}function z(t,e){var i=1<arguments.length&&void 0!==e?e:2;return Number(t.toFixed(i))}return function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.rotate=0,this.dragStatus=0,this.cursorEnums=["default","nw-resize","w-resize","sw-resize","n-resize","s-resize","ne-resize","e-resize","se-resize","move"],this.cutterIsEnter=!1,this.ropperIsDown=!1,this.startPos=null,this.defaultConfig={cutWidth:200,cutHeight:200,mincutWidth:16,mincutHeight:16,maxScale:3,minScale:.1,scale:1.2,canMagnify:!0,canReduce:!0,canRotate:!0,canChangeCutSize:!0,imageSrc:"",containerEl:"",mangnifyEl:"",reduceEl:"",cutEl:"",rotateEl:"",onRender:null,onCut:null},this.checkConfig(t)&&this.init()}var t,i,n;return t=e,(i=[{key:"checkConfig",value:function(e){if(x(e))return!1;if("object"!==H(e))return M("配置信息格式不合法");["cutWidth","cutHeight","mincutWidth","mincutHeight","maxScale","minScale","scale"].forEach(function(t){e.hasOwnProperty(t)&&(e[t]=parseFloat(e[t]))});var t=(e=w(w({},this.defaultConfig),e)).containerEl,i=e.mincutWidth,n=e.mincutHeight,r=e.cutWidth,o=e.cutHeight,s=e.maxScale,a=e.minScale,c=e.canReduce,u=e.canMagnify;if(x(t))return M("containerEl未配置");var h=document.querySelector(t);if(!h)return M(t+"的dom元素不存在");if(this.container=h,e.canChangeCutSize){if(!x(n)){if(!S(n))return M("mincutHeight必须为数值");if(Number(n)<1)return M("mincutHeight不能小于1")}if(!x(i)){if(!S(i))return M("mincutWidth必须为数值");if(Number(i)<1)return M("mincutWidth不能小于1")}}if(!x(r)){if(!S(r))return M("cutWidtht必须为数值");if(Number(r)<1)return M("cutWidth不能小于1")}if(!x(o)){if(!S(o))return M("cutHeight必须为数值");if(Number(o)<1)return M("cutHeight不能小于1")}if(u){if(!x(s)){if(!S(s))return M("maxScale必须为数值");if(Number(s)<1)return M("maxScale不能小于1")}var l=e.mangnifyEl;if(x(l))return M("mangnifyEl未配置");var f=document.querySelector(l);if(!f)return M(l+"的dom元素不存在");this.mangnifyNode=f}if(c){if(!x(a)){if(!S(a))return M("minScale必须为数值");if(1<=Number(a))return M("minScale必须小于1")}var g=e.reduceEl;if(x(g))return M("reduceEl未配置");var m=document.querySelector(g);if(!m)return M(g+"的dom元素不存在");this.reduceNode=m}if(u||c){var d=this.scale;if(!x(d)){if(!S(d))return M("scale必须为数值");if(Number(s)<=1)return M("scale必须大于1")}}var y=e.cutEl;if(!x(y)){var p=document.querySelector(y);if(!p)return M(y+"的dom不存在");this.submitNode=p}if(x(e.imageSrc))return M("imageSrc不能为空");var v=e.canRotate,k=e.rotateEl;if(v){if(x(k))return M("rotateEl未配置");var b=document.querySelector(k);if(!b)return M(k+"的dom不存在");this.rotateNode=b}return this.config=e,!0}},{key:"init",value:function(){var e=this;this.canvas=document.createElement("canvas"),this.loadImage(function(){e.initContainer();var t=e.config.onRender;C(t)&&t(),e.bindEvent()})}},{key:"loadImage",value:function(t){var e=this,i=this.config.imageSrc,n=new Image;n.src=i,n.onload=function(){e.image=n,C(t)&&t()},n.onerror=function(){M("图片资源加载失败")}}},{key:"initContainer",value:function(){var t=this.container,e=this.image,i=e.naturalHeight,n=e.naturalWidth,r=t.offsetHeight,o=t.offsetWidth;this.containerH=r,this.containerW=o;var s=this.orgImgW=n,a=n/(this.orgImgH=i);r<(u=i)?o<s&&a<o/r?s=(u=r)*a:u=(s=o)/a:o<s&&(s=(u=r)*a);var c=this.adjustToCut(s,u),s=z(c.imgWidth),u=z(c.imgHeight);e.style.width=s+"px",e.style.height=u+"px";var h=(r-u)/2,l=(o-s)/2;this.imgWidth=s,this.imgHeight=u,e.style.top=h+"px",e.style.left=l+"px",this.imgTop=h,this.imgLeft=l,e.style.position="absolute",t.style.position="relative",t.style.overflow="hidden",t.appendChild(e),this.addMask()}},{key:"addMask",value:function(){var e=this.container,t=this.containerH,i=this.containerW,n=this.config,r=n.cutHeight,o=n.cutWidth,s=document.createElement("div");s.setAttribute("style","position:absolute;box-sizing: border-box;border: 1px dashed #fff;");var a=this.createMask(),c=this.createMask(),u=this.createMask(),h=this.createMask();a.style.left=0,c.style.right=0,u.style.top=0,h.style.bottom=0,[a,c,u,h,s].forEach(function(t){e.appendChild(t)}),this.cutterBox=s,this.leftMask=a,this.rightMask=c,this.topMask=u,this.bottomMask=h;var l=(i-o)/2,f=(t-r)/2;this.setMaskStyle(l,f,o,r)}},{key:"setMaskStyle",value:function(t,e,i,n){var r=this.cutterBox,o=this.leftMask,s=this.rightMask,a=this.bottomMask,c=this.topMask,u=this.containerW,h=this.containerH;r.style.top=e+"px",r.style.left=t+"px",r.style.width=i+"px",r.style.height=n+"px",s.style.width=u-t-i+"px",o.style.width=t+"px",o.style.height=s.style.height=h+"px",c.style.width=a.style.width=i+"px",a.style.height=h-e-n+"px",c.style.height=e+"px",c.style.left=a.style.left=t+"px",this.config.cutWidth=i,this.config.cutHeight=n,this.cutTop=e,this.cutLeft=t}},{key:"createMask",value:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.background="rgba(255, 255, 255, 0.45)",t}},{key:"bindEvent",value:function(){var e=this,i=this.container;this.cutterBox.onmouseenter=function(t){e.cutterIsEnter=!0,e.initMouse(t),i.onmousemove=function(t){e.cutterIsEnter&&(e.cutterIsDown?e.handleResize(t):e.initMouse(t))},i.onmousedown=function(t){e.cutterIsEnter&&(e.dragStatus<=0||(e.cutterIsDown=!0,e.handleMouseDown(t),i.onmouseup=function(){e.cutterIsDown&&(e.cutterIsDown=!1,e.checkCutterBox(),i.onmouseup=null)}))}},i.onmouseleave=function(){e.cutterIsEnter=!1,e.dragStatus=0,e.cutterIsDown=!1,i.onmousemove=null,i.onmousedown=null,i.onmouseup=null,e.checkCutterBox()};var t=this.config,n=t.canRotate,r=t.canMagnify,o=t.canReduce,s=t.scale;r&&this.mangnifyNode&&(this.mangnifyNode.onclick=function(){e.config.canMagnify&&e.changeImageSize(s)}),o&&this.reduceNode&&(this.reduceNode.onclick=function(){e.config.canReduce&&e.changeImageSize(1/s)}),n&&this.rotateNode&&(this.rotateNode.onclick=function(){e.rotateImage()}),this.submitNode&&(this.submitNode.onclick=function(){e.cutImage()})}},{key:"cutImage",value:function(){var t,e,i,n,r,o,s,a,c=this.canvas,u=this.rotate,h=this.orgImgW,l=this.imgHeight,f=this.imgWidth,g=this.imgTop,m=this.imgLeft,d=this.cutLeft,y=this.cutTop,p=this.image,v=this.containerW,k=this.containerH,b=this.config,w=b.cutHeight,H=b.cutWidth,x=b.onCut,S=f/h,M=c.getContext("2d"),W=H/S,I=w/S;c.width=H,c.height=w,-1===u?(t=z((k-w-y-(k-f)/2)/S),e=z((d-(v-l)/2)/S),W=w/S,I=H/S,M.rotate(90*u*Math.PI/180),M.drawImage(p,t,e,W,I,-w,0,w,H)):-2===u?(i=this.toFixed((v-d-H-(v-f)/2)/S),n=this.toFixed((k-w-y-(k-l)/2)/S),M.rotate(90*u*Math.PI/180),M.drawImage(p,i,n,W,I,-H,-w,H,w)):-3===u?(r=this.toFixed((y-(k-f)/2)/S),o=this.toFixed((v-d-H-(v-l)/2)/S),W=w/S,I=H/S,M.rotate(90*u*Math.PI/180),M.drawImage(p,r,o,W,I,0,-H,w,H)):(s=(d-m)/S,a=(y-g)/S,M.drawImage(p,s,a,W,I,0,0,H,w));var E=c.toDataURL("image/png");return C(x)&&x(E),E}},{key:"changeImageSize",value:function(t){var e=this.imgWidth,i=this.orgImgW,n=this.orgImgH,r=this.imgHeight,o=this.containerH,s=this.containerW,a=this.image,c=this.config,u=c.maxScale,h=c.minScale,l=c.onManify,f=c.onReduce;e*=t,r*=t,1<t?(this.config.canReduce=!0,u<e/i&&(this.config.canMagnify=!1,e=i*u,r=n*u)):(this.config.canMagnify=!0,e/i<h&&(this.containerH.canReduce=!1,e=i*h,r=n*h));var g=this.adjustToCut(e,r),e=z(g.imgWidth),r=z(g.imgHeight);this.imgWidth=e,this.imgHeight=r,a.style.width=e+"px",a.style.height=r+"px";var m=z((o-r)/2),d=z((s-e)/2);a.style.top=m+"px",a.style.left=d+"px",this.imgTop=m,this.imgLeft=d,this.checkCutterBox(),1<t&&C(l)&&l(this.config),t<1&&C(f)&&f(this.config)}},{key:"rotateImage",value:function(){var t=this.rotate;--t%4==0&&(t=0),this.image.style.transform="rotate(".concat(90*t,"deg)"),this.rotate=t,this.checkCutterBox()}},{key:"initMouse",value:function(t){var e,i,n,r,o,s,a,c,u,h,l,f;t.preventDefault(),this.cutterIsEnter&&(e=this.cutterBox,i=this.cursorEnums,n=this.container,o=(r=this.config).cutWidth,s=r.cutHeight,a=r.canChangeCutSize,c=t.clientX,l=t.clientY-(u=e.getBoundingClientRect()).top,f=0,(h=c-u.left)<10&&-10<h?l<10&&-10<l?f=1:10<=l&&l<=s-10?f=2:s-10<l&&l<s+10&&(f=3):10<=h&&h<=o-10?l<10&&-10<l?f=4:s-10<l&&l<s+10?f=5:10<=l&&l<=s-10&&(f=9):o-10<h&&h<o+10&&(l<10&&-10<l?f=6:10<=l&&l<=s-10?f=7:s-10<l&&l<s+10&&(f=8)),(a||!a&&9===f)&&(e.style.cursor=i[f]||"default",this.dragStatus=f),(h<-10||o+10<h||l<-10||s+10<l)&&(this.cutterIsEnter=!1,this.cutterIsDown=!1,n.onmousemove=null,n.onmousedown=null,n.onmouseup=null))}},{key:"handleResize",value:function(t){t.preventDefault();var e,i,n=this.config,r=n.cutWidth,o=n.cutHeight,s=n.mincutWidth,a=this.cutTop,c=this.cutLeft,u=this.startPos,h=this.dragStatus,l=this.containerW,f=this.containerH,g=t.clientX-u.clientX,m=t.clientY-u.clientY;if(1<=h&&h<=3){var d,y=r-g,p=c+g,v=o,k=a;if(y<s)return;p<0&&(p=0),1===h?(v=(d=this.resizeTop(o,a,m)).newHeight,k=d.newTop):3===h&&(v=this.resizeBottom(o,a,m).newHeight),this.setMaskStyle(p,k,y,v)}else if(4===h){var b=this.resizeTop(o,a,m),w=b.newHeight,H=b.newTop;this.setMaskStyle(c,H,r,w)}else if(5===h){var x=this.resizeBottom(o,a,m).newHeight;this.setMaskStyle(c,a,r,x)}else if(6<=h&&h<=8){var S,M=r+g,W=a,I=o;if(M<s)return;l<c+M&&(M=l-r),6===h?(I=(S=this.resizeTop(o,a,m)).newHeight,W=S.newTop):8===h&&(I=this.resizeBottom(o,a,m).newHeight),this.setMaskStyle(c,W,M,I)}else{9===h&&((i=a+m)<0&&(i=0),(e=c+g)<0&&(e=0),l<e+r&&(e=l-r),f<i+o&&(i=f-o),this.setMaskStyle(e,i,r,o))}this.startPos={clientX:t.clientX,clientY:t.clientY}}},{key:"checkCutterBox",value:function(){var t,e=this.config,i=e.cutHeight,n=e.cutWidth,r=this.cutterBox,o=this.cutTop,s=this.cutLeft,a=this.imgTop,c=this.imgLeft,u=this.imgHeight,h=this.imgWidth,l=this.bottomMask,f=this.topMask,g=this.rightMask,m=this.leftMask,d=this.containerW,y=this.containerH;this.rotate%2!=0&&(c=(d-u)/2,a=(y-h)/2,t=h,h=u,u=t),h<n&&(n=h),u<i&&(i=u),s<c&&(s=c),c+h<s+n&&(s=c+h-n),o<a&&(o=a),a+u<o+i&&(o=a+u-i);var p=[r,l,f,g,m];p.forEach(function(t){t.style.transition="all 0.3s"}),this.setMaskStyle(s,o,n,i),setTimeout(function(){p.forEach(function(t){t.style.transition=""})},300)}},{key:"handleMouseDown",value:function(t){this.startPos={clientX:t.clientX,clientY:t.clientY}}},{key:"resizeTop",value:function(t,e,i){var n=t-i,r=e+i;if(!(n<this.config.mincutHeight))return r<0&&(r=0),{newTop:r,newHeight:n}}},{key:"resizeBottom",value:function(t,e,i){var n=this.containerH,r=t+i;if(!(r<this.config.mincutHeight))return n<e+r&&(r=n-e),{newHeight:r}}},{key:"adjustToCut",value:function(t,e){var i=this.orgImgW,n=this.orgImgH,r=this.config,o=r.cutWidth,s=r.cutHeight,a=i/n,c=o/s;return e<s?(this.config.canReduce=!1,!(t<o)||c<a?t=(e=s)*a:e=(t=o)/a):t<o&&(this.config.canReduce=!1,e=(t=o)/a),{imgWidth:t,imgHeight:e}}}])&&r(t.prototype,i),n&&r(t,n),e}()});

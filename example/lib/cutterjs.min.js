/**
 * CropperJS v1.0.1 Copyright (c) Fri Jul 31 2020 20:41:30 GMT+0800 (中国标准时间), JIANGXUEYANG All Rights Reserved,
 *     see: for Details
 *     @license MIT
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Cutter=e()}(this,function(){"use strict";function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(e,t){var i,n=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)),n}function w(r){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,i,n;e=r,n=o[i=t],i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(o,t))})}return r}function H(t){return Object.prototype.toString.call(t).toLowerCase().slice(8,-1)}function E(t){return"function"===H(t)}function x(t){return null===t||""===t||void 0===t}function S(t){return"number"===H(t)||/^\d+$/.test(t)}function C(t){return console.error(t),!1}function z(t,e){var i=1<arguments.length&&void 0!==e?e:2;return Number(t.toFixed(i))}return function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.rotate=0,this.dragStatus=0,this.cursorEnums=["default","nw-resize","w-resize","sw-resize","n-resize","s-resize","ne-resize","e-resize","se-resize","move"],this.cropperIsEnter=!1,this.ropperIsDown=!1,this.startPos=null,this.defaultConfig={cropWidth:200,cropHeight:200,minCropWidth:16,minCropHeight:16,maxScale:3,minScale:.1,scale:1.2,canMagnify:!0,canReduce:!0,canRotate:!0,canChangeCropSize:!0,imageSrc:"",containerEl:"",mangnifyEl:"",reduceEl:"",cropEl:"",rotateEl:"",onRender:null,onCrop:null},this.checkConfig(t)&&this.init()}var t,i,n;return t=e,(i=[{key:"checkConfig",value:function(e){if(x(e))return!1;if("object"!==H(e))return C("配置信息格式不合法");["cropWidth","cropHeight","minCropWidth","minCropHeight","maxScale","minScale","scale"].forEach(function(t){e.hasOwnProperty(t)&&(e[t]=parseFloat(e[t]))});var t=(e=w(w({},this.defaultConfig),e)).containerEl,i=e.minCropWidth,n=e.minCropHeight,r=e.cropWidth,o=e.cropHeight,s=e.maxScale,a=e.minScale,c=e.canReduce,h=e.canMagnify;if(x(t))return C("containerEl未配置");var u=document.querySelector(t);if(!u)return C(t+"的dom元素不存在");if(this.container=u,e.canChangeCropSize){if(!x(n)){if(!S(n))return C("minCropHeight必须为数值");if(Number(n)<1)return C("minCropHeight不能小于1")}if(!x(i)){if(!S(i))return C("minCropWidth必须为数值");if(Number(i)<1)return C("minCropWidth不能小于1")}}if(!x(r)){if(!S(r))return C("cropWidtht必须为数值");if(Number(r)<1)return C("cropWidth不能小于1")}if(!x(o)){if(!S(o))return C("cropHeight必须为数值");if(Number(o)<1)return C("cropHeight不能小于1")}if(h){if(!x(s)){if(!S(s))return C("maxScale必须为数值");if(Number(s)<1)return C("maxScale不能小于1")}var l=e.mangnifyEl;if(x(l))return C("mangnifyEl未配置");var f=document.querySelector(l);if(!f)return C(l+"的dom元素不存在");this.mangnifyNode=f}if(c){if(!x(a)){if(!S(a))return C("minScale必须为数值");if(1<=Number(a))return C("minScale必须小于1")}var p=e.reduceEl;if(x(p))return C("reduceEl未配置");var g=document.querySelector(p);if(!g)return C(p+"的dom元素不存在");this.reduceNode=g}if(h||c){var m=this.scale;if(!x(m)){if(!S(m))return C("scale必须为数值");if(Number(s)<=1)return C("scale必须大于1")}}var d=e.cropEl;if(!x(d)){var y=document.querySelector(d);if(!y)return C(d+"的dom不存在");this.submitNode=y}if(x(e.imageSrc))return C("imageSrc不能为空");var v=e.canRotate,k=e.rotateEl;if(v){if(x(k))return C("rotateEl未配置");var b=document.querySelector(k);if(!b)return C(k+"的dom不存在");this.rotateNode=b}return this.config=e,!0}},{key:"init",value:function(){var e=this;this.canvas=document.createElement("canvas"),this.loadImage(function(){e.initContainer();var t=e.config.onRender;E(t)&&t(),e.bindEvent()})}},{key:"loadImage",value:function(t){var e=this,i=this.config.imageSrc,n=new Image;n.src=i,n.onload=function(){e.image=n,E(t)&&t()},n.onerror=function(){C("图片资源加载失败")}}},{key:"initContainer",value:function(){var t=this.container,e=this.image,i=e.naturalHeight,n=e.naturalWidth,r=t.offsetHeight,o=t.offsetWidth;this.containerH=r,this.containerW=o;var s=this.orgImgW=n,a=n/(this.orgImgH=i);r<(h=i)?o<s&&a<o/r?s=(h=r)*a:h=(s=o)/a:o<s&&(s=(h=r)*a);var c=this.adjustToCrop(s,h),s=z(c.imgWidth),h=z(c.imgHeight);e.style.width=s+"px",e.style.height=h+"px";var u=(r-h)/2,l=(o-s)/2;this.imgWidth=s,this.imgHeight=h,e.style.top=u+"px",e.style.left=l+"px",this.imgTop=u,this.imgLeft=l,e.style.position="absolute",t.style.position="relative",t.style.overflow="hidden",t.appendChild(e),this.addMask()}},{key:"addMask",value:function(){var e=this.container,t=this.containerH,i=this.containerW,n=this.config,r=n.cropHeight,o=n.cropWidth,s=document.createElement("div");s.setAttribute("style","position:absolute;box-sizing: border-box;border: 1px dashed #fff;");var a=this.createMask(),c=this.createMask(),h=this.createMask(),u=this.createMask();a.style.left=0,c.style.right=0,h.style.top=0,u.style.bottom=0,[a,c,h,u,s].forEach(function(t){e.appendChild(t)}),this.cropBox=s,this.leftMask=a,this.rightMask=c,this.topMask=h,this.bottomMask=u;var l=(i-o)/2,f=(t-r)/2;this.setMaskStyle(l,f,o,r)}},{key:"setMaskStyle",value:function(t,e,i,n){var r=this.cropBox,o=this.leftMask,s=this.rightMask,a=this.bottomMask,c=this.topMask,h=this.containerW,u=this.containerH;r.style.top=e+"px",r.style.left=t+"px",r.style.width=i+"px",r.style.height=n+"px",s.style.width=h-t-i+"px",o.style.width=t+"px",o.style.height=s.style.height=u+"px",c.style.width=a.style.width=i+"px",a.style.height=u-e-n+"px",c.style.height=e+"px",c.style.left=a.style.left=t+"px",this.config.cropWidth=i,this.config.cropHeight=n,this.cropTop=e,this.cropLeft=t}},{key:"createMask",value:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.background="rgba(255, 255, 255, 0.45)",t}},{key:"bindEvent",value:function(){var e=this,i=this.container;this.cropBox.onmouseenter=function(t){e.cropperIsEnter=!0,e.initMouse(t),i.onmousemove=function(t){e.cropperIsEnter&&(e.cropperIsDown?e.handleResize(t):e.initMouse(t))},i.onmousedown=function(t){e.cropperIsEnter&&(e.dragStatus<=0||(e.cropperIsDown=!0,e.handleMouseDown(t),i.onmouseup=function(){e.cropperIsDown&&(e.cropperIsDown=!1,e.checkCropperBox(),i.onmouseup=null)}))}},i.onmouseleave=function(){e.cropperIsEnter=!1,e.dragStatus=0,e.cropperIsDown=!1,i.onmousemove=null,i.onmousedown=null,i.onmouseup=null,e.checkCropperBox()};var t=this.config,n=t.canRotate,r=t.canMagnify,o=t.canReduce,s=t.scale;r&&this.mangnifyNode&&(this.mangnifyNode.onclick=function(){e.config.canMagnify&&e.changeImageSize(s)}),o&&this.reduceNode&&(this.reduceNode.onclick=function(){e.config.canReduce&&e.changeImageSize(1/s)}),n&&this.rotateNode&&(this.rotateNode.onclick=function(){e.rotateImage()}),this.submitNode&&(this.submitNode.onclick=function(){e.cropImage()})}},{key:"cropImage",value:function(){var t,e,i,n,r,o,s,a,c=this.canvas,h=this.rotate,u=this.orgImgW,l=this.imgHeight,f=this.imgWidth,p=this.imgTop,g=this.imgLeft,m=this.cropLeft,d=this.cropTop,y=this.image,v=this.containerW,k=this.containerH,b=this.config,w=b.cropHeight,H=b.cropWidth,x=b.onCrop,S=f/u,C=c.getContext("2d"),M=H/S,W=w/S;c.width=H,c.height=w,-1===h?(t=z((k-w-d-(k-f)/2)/S),e=z((m-(v-l)/2)/S),M=w/S,W=H/S,C.rotate(90*h*Math.PI/180),C.drawImage(y,t,e,M,W,-w,0,w,H)):-2===h?(i=this.toFixed((v-m-H-(v-f)/2)/S),n=this.toFixed((k-w-d-(k-l)/2)/S),C.rotate(90*h*Math.PI/180),C.drawImage(y,i,n,M,W,-H,-w,H,w)):-3===h?(r=this.toFixed((d-(k-f)/2)/S),o=this.toFixed((v-m-H-(v-l)/2)/S),M=w/S,W=H/S,C.rotate(90*h*Math.PI/180),C.drawImage(y,r,o,M,W,0,-H,w,H)):(s=(m-g)/S,a=(d-p)/S,C.drawImage(y,s,a,M,W,0,0,H,w));var I=c.toDataURL("image/png");return E(x)&&x(I),I}},{key:"changeImageSize",value:function(t){var e=this.imgWidth,i=this.orgImgW,n=this.orgImgH,r=this.imgHeight,o=this.containerH,s=this.containerW,a=this.image,c=this.config,h=c.maxScale,u=c.minScale,l=c.onManify,f=c.onReduce;e*=t,r*=t,1<t?(this.config.canReduce=!0,h<e/i&&(this.config.canMagnify=!1,e=i*h,r=n*h)):(this.config.canMagnify=!0,e/i<u&&(this.containerH.canReduce=!1,e=i*u,r=n*u));var p=this.adjustToCrop(e,r),e=z(p.imgWidth),r=z(p.imgHeight);this.imgWidth=e,this.imgHeight=r,a.style.width=e+"px",a.style.height=r+"px";var g=z((o-r)/2),m=z((s-e)/2);a.style.top=g+"px",a.style.left=m+"px",this.imgTop=g,this.imgLeft=m,this.checkCropperBox(),1<t&&E(l)&&l(this.config),t<1&&E(f)&&f(this.config)}},{key:"rotateImage",value:function(){var t=this.rotate;--t%4==0&&(t=0),this.image.style.transform="rotate(".concat(90*t,"deg)"),this.rotate=t,this.checkCropperBox()}},{key:"initMouse",value:function(t){var e,i,n,r,o,s,a,c,h,u,l,f;t.preventDefault(),this.cropperIsEnter&&(e=this.cropBox,i=this.cursorEnums,n=this.container,o=(r=this.config).cropWidth,s=r.cropHeight,a=r.canChangeCropSize,c=t.clientX,l=t.clientY-(h=e.getBoundingClientRect()).top,f=0,(u=c-h.left)<10&&-10<u?l<10&&-10<l?f=1:10<=l&&l<=s-10?f=2:s-10<l&&l<s+10&&(f=3):10<=u&&u<=o-10?l<10&&-10<l?f=4:s-10<l&&l<s+10?f=5:10<=l&&l<=s-10&&(f=9):o-10<u&&u<o+10&&(l<10&&-10<l?f=6:10<=l&&l<=s-10?f=7:s-10<l&&l<s+10&&(f=8)),(a||!a&&9===f)&&(e.style.cursor=i[f]||"default",this.dragStatus=f),(u<-10||o+10<u||l<-10||s+10<l)&&(this.cropperIsEnter=!1,this.cropperIsDown=!1,n.onmousemove=null,n.onmousedown=null,n.onmouseup=null))}},{key:"handleResize",value:function(t){t.preventDefault();var e,i,n=this.config,r=n.cropWidth,o=n.cropHeight,s=n.minCropWidth,a=this.cropTop,c=this.cropLeft,h=this.startPos,u=this.dragStatus,l=this.containerW,f=this.containerH,p=t.clientX-h.clientX,g=t.clientY-h.clientY;if(1<=u&&u<=3){var m,d=r-p,y=c+p,v=o,k=a;if(d<s)return;y<0&&(y=0),1===u?(v=(m=this.resizeTop(o,a,g)).newHeight,k=m.newTop):3===u&&(v=this.resizeBottom(o,a,g).newHeight),this.setMaskStyle(y,k,d,v)}else if(4===u){var b=this.resizeTop(o,a,g),w=b.newHeight,H=b.newTop;this.setMaskStyle(c,H,r,w)}else if(5===u){var x=this.resizeBottom(o,a,g).newHeight;this.setMaskStyle(c,a,r,x)}else if(6<=u&&u<=8){var S,C=r+p,M=a,W=o;if(C<s)return;l<c+C&&(C=l-r),6===u?(W=(S=this.resizeTop(o,a,g)).newHeight,M=S.newTop):8===u&&(W=this.resizeBottom(o,a,g).newHeight),this.setMaskStyle(c,M,C,W)}else{9===u&&((i=a+g)<0&&(i=0),(e=c+p)<0&&(e=0),l<e+r&&(e=l-r),f<i+o&&(i=f-o),this.setMaskStyle(e,i,r,o))}this.startPos={clientX:t.clientX,clientY:t.clientY}}},{key:"checkCropperBox",value:function(){var t,e=this.config,i=e.cropHeight,n=e.cropWidth,r=this.cropBox,o=this.cropTop,s=this.cropLeft,a=this.imgTop,c=this.imgLeft,h=this.imgHeight,u=this.imgWidth,l=this.bottomMask,f=this.topMask,p=this.rightMask,g=this.leftMask,m=this.containerW,d=this.containerH;this.rotate%2!=0&&(c=(m-h)/2,a=(d-u)/2,t=u,u=h,h=t),u<n&&(n=u),h<i&&(i=h),s<c&&(s=c),c+u<s+n&&(s=c+u-n),o<a&&(o=a),a+h<o+i&&(o=a+h-i);var y=[r,l,f,p,g];y.forEach(function(t){t.style.transition="all 0.3s"}),this.setMaskStyle(s,o,n,i),setTimeout(function(){y.forEach(function(t){t.style.transition=""})},300)}},{key:"handleMouseDown",value:function(t){this.startPos={clientX:t.clientX,clientY:t.clientY}}},{key:"resizeTop",value:function(t,e,i){var n=t-i,r=e+i;if(!(n<this.config.minCropHeight))return r<0&&(r=0),{newTop:r,newHeight:n}}},{key:"resizeBottom",value:function(t,e,i){var n=this.containerH,r=t+i;if(!(r<this.config.minCropHeight))return n<e+r&&(r=n-e),{newHeight:r}}},{key:"adjustToCrop",value:function(t,e){var i=this.orgImgW,n=this.orgImgH,r=this.config,o=r.cropWidth,s=r.cropHeight,a=i/n,c=o/s;return e<s?(this.config.canReduce=!1,!(t<o)||c<a?t=(e=s)*a:e=(t=o)/a):t<o&&(this.config.canReduce=!1,e=(t=o)/a),{imgWidth:t,imgHeight:e}}}])&&r(t.prototype,i),n&&r(t,n),e}()});
